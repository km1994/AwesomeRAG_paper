### Class-RAG【法官】
> **法官**：不是靠死板的条文判案，而是通过不断扩充的判例库来研判。像个经验老到的法官，手握活页法典，随时翻阅最新案例，让判决既有温度又有尺度。
>

* 发表时间：2024.10.18
* 论文名称：[Class-RAG: Content Moderation with Retrieval Augmented Generation](https://arxiv.org/abs/2410.14881)
* 论文地址：[https://arxiv.org/abs/2410.14881](https://arxiv.org/abs/2410.14881)
* Github 地址：

#### 一、论文动机

随着生成式 AI 的广泛应用，内容审核的重要性日益凸显。然而，**传统的模型微调方法在处理内容审核任务时面临诸多挑战，例如标注数据的主观性强、不同地区和受众的审核要求差异大，以及持续微调成本高昂等问题**。为此，本文提出了一种基于检索增强生成（RAG）的内容审核方法——Class-RAG，通过动态更新检索库来实现即时风险缓解，提升审核性能。

#### 二、论文思路

![](20241018_Class-RAG/img/v2-5ab696f0b8cd741d5d7e6f3d06880202_1440w.png)

Class-RAG 的核心架构包括以下部分：

1. **嵌入模型**：使用 DRAGON RoBERTa 作为嵌入模型，将输入文本向量化。此外，还评估了 WPIE（Whole Post Integrity Embedding）模型的变体。
2. **检索库**：由安全用例库和不安全用例库组成，每个条目包含提示、标签、嵌入和解释四个属性。通过 K-Means 聚类算法从安全和不安全案例中挑选中心案例，形成检索库。
3. **检索模块**：利用 Faiss 库进行相似性搜索，从检索库中检索出与输入最相关的两个安全示例和两个不安全示例，使用 L2 距离度量计算相似度。
4. **微调的 LLM 分类器**：将检索到的参考案例和输入提示一起输入到微调的 LLM 中进行分类。

#### 三、实验设计与结果

1. 分类性能及对抗性攻击的稳健性

Class-RAG 在 CoPro 数据集的同分布（ID）和分布外（OOD）测试集上进行了全面测评，与 WPIE 和 LLAMA3 两个基线模型对比。结果显示，Class-RAG 在分类性能上优于基线模型，尤其是在对抗性攻击方面表现出更强的稳健性。

2. 对外部数据源的适应能力

Class-RAG 的一个重要优势是能够快速适应外部数据，而无需重新训练模型。实验表明，加入外部数据源后，Class-RAG 在 I2P++ 数据集上的 AUPRC 分数从 0.229 提升至 0.791，对抗性攻击性能从 0.235 提升至 0.677；在 UD 数据集上，AUPRC 分数从 0.917 提升至 0.985，对抗性攻击性能从 0.914 提高到 0.976。

3. 遵循指令的能力

Class-RAG 具有很强的遵循参考示例的能力。在带有翻转 ID 库的测试中，99.49% 的真实安全示例的预测标签成功翻转，而真实不安全示例的翻转率仅为 12.29%。

4. 相对于检索库大小的性能可扩展性

实验表明，随着检索库规模的扩大，Class-RAG 的性能稳步提升。在 I2P++ 数据集上，AUPRC 分数从无外部库时的 0.235 提升至完整外部库时的 0.677；在 UD 数据集上，AUPRC 分数从 0.914 提升至 0.974。扩大检索库规模是一种经济高效的提升性能的策略。

5. 参考样本数量对性能的影响

增加参考样本数量能够提升 Class-RAG 的性能，但计算成本也会增加。实验表明，在 I2P++ 数据集上，参考样本数量从 0 增加到 8 时，AUPRC 分数从 0.303 提升至 0.721；在 UD 数据集上，AUPRC 分数从 0.932 提升至 0.980。

6. 嵌入模型对性能的影响

DRAGON RoBERTa 的嵌入效果优于 WPIE 模型。在 ID 测试集上，DRAGON RoBERTa 的平均 AUPRC 为 0.938，而在 OOD 测试集上为 0.920，均优于 WPIE 的表现。

#### 四、论文总结

Class-RAG 通过检索增强生成技术，有效提升了内容审核的性能，尤其是在对抗性攻击的稳健性和对外部数据的适应能力方面表现出色。通过动态更新检索库，Class-RAG 能够灵活应对不断变化的内容审核需求，同时降低了持续微调的成本。


## 致谢

* 参考：[https://mp.weixin.qq.com/s/4AfZodMGJ5JQ2NUCFt3eqQ](https://mp.weixin.qq.com/s/4AfZodMGJ5JQ2NUCFt3eqQ)